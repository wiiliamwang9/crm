<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API配置测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .config-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
    <script src="api-config.js"></script>
</head>
<body>
    <h1>全局API配置测试页面</h1>
    
    <div class="config-item">
        <h3>配置信息</h3>
        <p><strong>环境:</strong> <span id="env-name">-</span></p>
        <p><strong>基础URL:</strong> <span id="base-url">-</span></p>
        <p><strong>超时时间:</strong> <span id="timeout">-</span></p>
    </div>
    
    <div class="config-item">
        <h3>API端点测试</h3>
        <div id="endpoints-list"></div>
    </div>
    
    <div class="config-item">
        <h3>连接测试</h3>
        <button onclick="testConnection()">测试连接</button>
        <div id="connection-result"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('页面加载完成，等待全局配置...');
            
            // 等待全局配置加载
            let maxWait = 50; // 最多等待5秒
            while (!window.GlobalApiConfig && maxWait > 0) {
                await new Promise(resolve => setTimeout(resolve, 100));
                maxWait--;
            }
            
            if (window.GlobalApiConfig) {
                console.log('全局配置加载成功！', window.GlobalApiConfig);
                displayConfig();
                displayEndpoints();
            } else {
                console.error('全局配置加载失败！');
                document.body.innerHTML += '<div class="error"><h2>错误: 全局配置加载失败</h2></div>';
            }
        });

        function displayConfig() {
            const config = window.GlobalApiConfig;
            document.getElementById('env-name').textContent = config.ENV_NAME;
            document.getElementById('base-url').textContent = config.BASE_URL;
            document.getElementById('timeout').textContent = config.TIMEOUT + 'ms';
        }

        function displayEndpoints() {
            const config = window.GlobalApiConfig;
            const endpointsList = document.getElementById('endpoints-list');
            
            const endpoints = [
                { name: '用户列表', url: config.getUrl(config.ENDPOINTS.USERS.ACTIVE) },
                { name: '客户详情', url: config.getUrl(config.ENDPOINTS.CUSTOMERS.DETAIL, { id: 108 }) },
                { name: '待办列表', url: config.getUrl(config.ENDPOINTS.TODOS.LIST) + '?customer_id=108' },
                { name: '客户搜索', url: config.getUrl(config.ENDPOINTS.CUSTOMERS.SEARCH) }
            ];

            endpointsList.innerHTML = endpoints.map(ep => 
                `<div><strong>${ep.name}:</strong> ${ep.url}</div>`
            ).join('');
        }

        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<p>正在测试连接...</p>';
            
            try {
                const result = await window.GlobalApiConfig.testConnection();
                if (result.success) {
                    resultDiv.innerHTML = `<div class="success">
                        <p>✅ 连接成功</p>
                        <p>状态: ${result.status} ${result.statusText}</p>
                    </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">
                        <p>❌ 连接失败</p>
                        <p>错误: ${result.error}</p>
                    </div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">
                    <p>❌ 连接测试异常</p>
                    <p>错误: ${error.message}</p>
                </div>`;
            }
        }
    </script>
</body>
</html>