<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="./styles/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CRMå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</h1>
            
            <div class="import-section">
                <div class="import-title">Excelæ•°æ®å¯¼å…¥</div>
                <form class="import-form" id="uploadForm" enctype="multipart/form-data">
                    <div class="file-input-wrapper">
                        <input type="file" id="excelFile" accept=".xlsx,.xls" required>
                        <label for="excelFile" class="file-input-label" id="fileLabel">
                            ğŸ“ é€‰æ‹©Excelæ–‡ä»¶
                        </label>
                    </div>
                    <button type="submit" class="import-btn" id="importBtn" disabled>
                        ğŸ“¤ ä¸Šä¼ å¹¶å¯¼å…¥
                    </button>
                </form>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="import-help">
                    æ”¯æŒæ ¼å¼ï¼š.xlsx, .xls | è‡ªåŠ¨è¯†åˆ«Excelç±»å‹ï¼šé”€å”®è®°å½•(53åˆ—)ã€å¾®ä¿¡å®¢æˆ·(14åˆ—)<br>
                    <strong>æ³¨æ„ï¼šè¯·ç¡®ä¿åç«¯APIæœåŠ¡æ­£å¸¸è¿è¡Œå¹¶å·²é…ç½®ä»£ç†</strong>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢å®¢æˆ·åç§°ã€è”ç³»äººæˆ–æ‰‹æœºå·...">
                <button onclick="searchCustomers()" class="btn btn-primary">
                    ğŸ” æœç´¢
                </button>
                <button onclick="loadCustomers()" class="btn btn-secondary">
                    ğŸ”„ åˆ·æ–°æ•°æ®
                </button>
            </div>
        </div>

        <div id="message" class="message"></div>

        <div class="table-container">
            <div id="loading" class="loading">æ­£åœ¨åŠ è½½å®¢æˆ·æ•°æ®...</div>
            <table id="customerTable" style="display: none;">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>å®¢æˆ·åç§°</th>
                        <th>è”ç³»äºº</th>
                        <th>æ‰‹æœºå·</th>
                        <th>å®¢æˆ·å¾®ä¿¡</th>
                        <th>åœ°å€ä¿¡æ¯</th>
                        <th>å®¢æˆ·çŠ¶æ€</th>
                        <th>é”€å”®å‘˜</th>
                        <th>å¯¼å…¥æ¥æº</th>
                        <th>å¤‡æ³¨</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody id="customerTableBody">
                </tbody>
            </table>
        </div>

        <div class="pagination" id="pagination" style="display: none;">
            <button onclick="previousPage()" class="btn btn-primary" id="prevBtn">
                â¬…ï¸ ä¸Šä¸€é¡µ
            </button>
            <span class="page-info" id="pageInfo"></span>
            <button onclick="nextPage()" class="btn btn-primary" id="nextBtn">
                ä¸‹ä¸€é¡µ â¡ï¸
            </button>
        </div>
    </div>

    <script type="module">
        import ExcelImport from './modules/excel-import.js';
        import CustomerList from './modules/customer-list.js';
        
        // åˆå§‹åŒ–æ¨¡å—
        const excelImport = new ExcelImport();
        const customerList = new CustomerList();
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶é‡æ–°åŠ è½½æ•°æ®
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && !excelImport.isUploading) {
                customerList.loadCustomers(customerList.currentPage, customerList.currentSearch);
            }
        });
    </script>
</body>
</html>